#### ES

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


    /**
     * 不同宿主环境中 ES 扮演着不同的角色
     * 
     * ES: 基础语言
     */

    + --- Browser ------------------- +
    |                                 |
    |                                 |
    |    In the browser environment   |             * 在浏览器环境中的 ES 被称为 JavaScript
    |    ES is called JS              |
    |                                 |
    |    WebAPI                       |
    |                                 |
    |   + --------------------- +     |
    |   |                       |     |
    |   |      ES Language      |     |
    |   |                       |     |
    |   + --------------------- +     |
    |                                 |
    + ------------------------------- +


    + --- Server -------------------- +
    |                                 |
    |                                 |
    |    In the server environment    |             * 在服务器环境中的 ES 被称为 Node
    |    ES is called Node            |
    |                                 |
    |    NodeAPI                      |
    |                                 |
    |   + --------------------- +     |
    |   |                       |     |
    |   |      ES Language      |     |
    |   |                       |     |
    |   + --------------------- +     |
    |                                 |
    + ------------------------------- +


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```


#### Call Stack

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



    /**
     * 执行栈( call stack )            // 用于暂时存储各种函数的执行环境
     * 
     * 
     * 1) 当函数执行时，会创建一个称为 '执行期上下文' 的全局内部对象
     *  
     * 2) 一个执行期上下文定义了一个函数执行时的环境，函数每次执行时对应的执行上下文都是独一无二的
     *  
     * 3) 多次调用一个函数会导致创建多个执行上下文，当函数执行完毕，执行上下文被销毁
     */


    /**
     * 
     * JS 引擎永远优先执行栈顶的任务
     * 
     */


                     + ----------------------- +
                     |                         |
                   + |    new execut task      | +
                   | |                         | |
     push stack ---- + ----------------------- + |
                   |                             |
                   |                             |
                   |                             |
                   |                             |
                   | + ----------------------- + ---- always execute first task
                   | |                         | |      
     stack top ----- |    first execut task    | |
                   | |                         | |
                   | + ----------------------- + ---- pop stack
                   | + ----------------------- + |
                   | |                         | |
                   | |           ...           | |
                   | |                         | |
                   | + ----------------------- + |
                   | + ----------------------- + |
                   | |                         | |
     stack bottom -- |    last execut task     | |
                   | |                         | |
                   | + ----------------------- + ---- first in, last out
                   + --------------------------- +
                           
                              Call Stack


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


    function a() {

        console.log('a');
        b();
    }

    function b() {

        console.log('b');
        c();
    }

    function c() {

        console.log('c');
    }

    console.log('global');
    a();


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


    function getFibonacci(num) {

        if (num === 1 || num === 2) {

            return 1;

        } else {

            return getFibonacci(num - 1) + getFibonacci(num - 2);
        }
    }


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```


``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


- JS 引擎线程: 

    - 解释执行 JS 代码、用户输入、网络输入
    
    - JS 引擎线程 和 GUI 线程执行时，会相互等待，等待另一个执行后，再执行

- GUI 线程: 

    - 绘制用户界面 和 JS 主线程互斥

    - JS 操作 DOM 元素时，会影响 GUI 的渲染结果，因此 JS 引擎线程与GUI渲染是互斥的
    
    - 当 JS 引擎线程处于运行状态，GUI 渲染线程将处于冻结状态

- HTTP 网络请求线程: 

    - 处理用户的 get、post 等请求，等返回结果后将回掉函数推入任务队列
    
- 定时触发器线程:

    - setTimeout、setInterval 等事件结束后执行函数推入任务队列
    
- 浏览器事件监听线程

    - 将 click、mouse 等交互事件发生后将这些事件放入事件队列中


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


      new execut task               
       + --------- +          
       |           |                                                                                      
    + -|- - - - - -|- +                                       Asynchronous execution                                                 
    |  + --------- +  |                                                                                      
    |                 |                                        + ----------------- +                         
    |                 |                                        |                   |                         
    |                 | ----------------------------- + -----> |  Event listener   |                         
    |                 |                               |        |  thread           |                         
    |                 |                               |        |                   |                         
    |                 |                               |        + ----------------- +        
    |                 |                               |                                                              
    |                 |     + ------------------- +   |        + ----------------- +                         
    |                 |     |                     |   |        |                   |                         
    |                 |     |      GPU Print      |   + -----> |  Network request  |                         
    |                 |     |                     |   |        |  thread           |                 
    |                 |     | - - - - - - - - - - |   |        |                   | 
    |                 |     |                     |   |        + ----------------- +                               
    |                 |     |  domTree + cssTree  |   |                                               
    | + ----------- + |     |                     |   |        + ----------------- + 
    | |             | |     |      renderTree     |   |        |                   |                  
    | |  Global OA  | |     |                     |   + -----> |  Timer trigger    |                  
    | |             | |     |         ...         |            |  thread           |                  
    | + ----------- + |     |                     |            |                   | 
    + --------------- +     + ------------------- +            + ----------------- +                  
        Call Stack          Graphical User Interface                    | |         
          / \                                                           | |
         /| |\                                                          | |
          | |                                                          \| |/
    | event queue                                                       \ /
    |                          + --- Macro queue: Timer, Event, Network ...
    |                          |     宏队列: 相对靠后执行
    | Javascript <- ... ... <- + 
    |  callback                |
                               + --- micro queue: mutationObserver, Promise ...
                                     微队列: 相对优先执行
                                     
                                     * mutationObserver: 监听的 Dom 元素改变时触发
                                                        (attribute, childList, subtree)

    /**
     * Browser Event Loop
     * 
     * 
     * 当上面的线程发生了某些事件时
     * 
     * 若该线程发现，此任务片段在浏览器环境中有执行它的线程，则会把它添加到指定线程中
     * 
     * 除 GUI 线程外，其他线程执行完任务片段，会把执行后的结果添加到 事件循环队列 等待执行    // 争抢任务序列
     * 
     * 当 执行栈中无任务时，会将事件循环队列中的第一个事件添加到执行栈中执行
     */


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```





